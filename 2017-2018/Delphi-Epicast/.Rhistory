        y.smooth<-seq(1,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=1,s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    i<-0
    for(y0 in seq(6,8,by=1e-4)){
        polygon(x=c(40,41,41,40,40),y=c(y0,y0,y0+1e-4,y0+1e-4,y0),col=hsv(h=1,s=i*5e-5,v=1),border=NA)
        i<-i+1
    }
    polygon(x=c(40,41,41,40,40),y=c(6,6,8,8,6),lwd=1)
    segments(x0=40,x1=42,y0=8,lwd=1)
    segments(x0=40,x1=42,y0=6,lwd=1)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<=season.weeks),]
        points(x=as.numeric(rownames(ILI))[-1]+forecast.week-39,y=ILI$weighted_ili[-1],type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.5))
        points(x=as.numeric(rownames(ILI))+forecast.week-39,y=ILI$weighted_ili,pch=19,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.5))
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))[-1]+season.weeks-39+forecast.week,y=ILI$weighted_ili[-1],type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.5))
        points(x=as.numeric(rownames(ILI))+season.weeks-39+forecast.week,y=ILI$weighted_ili,pch=19,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.5))
    }
    text(x=43,y=6,"Low Chance",pos=4,cex=2,lwd=4)
    text(x=43,y=8,"High Chance",pos=4,cex=2,lwd=4)
    dev.off()
}
for(file in files){
    forecasts<-read.csv(file)
    forecast.week<-as.numeric(substr(x=file,start=3,stop=4))
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week<=forecast.week & ILI$week>39),]
    }else{
        ILI<-ILI[which(ILI$week<=forecast.week | ILI$week>39),]
    }
    png(filename=paste0("C:/Users/iot0/Desktop/forecasting/short",forecast.week,".png"),width=1000,height=1000)
    par(lwd=4,mar=c(6,5,1,1))
    plot(x=rownames(ILI),y=ILI$weighted_ili,type="l",xlim=c(1,53),ylim=c(0,10),axes=FALSE,col="gray70",xlab="MMWR Week",ylab="ILI (%)",cex.axis=2,cex.lab=2)
    points(x=rownames(ILI),y=ILI$weighted_ili,pch=19,cex=2)
    axis(1,at=c(1,6,11,season.weeks-38,seq(season.weeks-33,season.weeks,by=5)),labels=c(40,45,50,1,seq(5,35,by=5)),cex.axis=2)
    axis(2,cex.axis=2)
    for(t in seq(1,4)){
        index<-which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & forecasts$type=="Bin")
        x0<-t+nrow(ILI)-0.4
        x1<-x0+0.8
        y<-as.numeric(as.character(forecasts$bin_start_incl[index]))
        probs<-forecasts$value[index]
        y.smooth<-seq(1,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=1,s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    i<-0
    for(y0 in seq(6,8,by=1e-4)){
        polygon(x=c(40,41,41,40,40),y=c(y0,y0,y0+1e-4,y0+1e-4,y0),col=hsv(h=1,s=i*5e-5,v=1),border=NA)
        i<-i+1
    }
    polygon(x=c(40,41,41,40,40),y=c(6,6,8,8,6),lwd=1)
    segments(x0=40,x1=42,y0=8,lwd=1)
    segments(x0=40,x1=42,y0=6,lwd=1)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<=season.weeks),]
        points(x=as.numeric(rownames(ILI))+forecast.week-39,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.5))
        points(x=as.numeric(rownames(ILI))[-1]+forecast.week-39,y=ILI$weighted_ili[-1],pch=19,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.5))
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))+season.weeks-39+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.5))
        points(x=as.numeric(rownames(ILI))[-1]+season.weeks-39+forecast.week,y=ILI$weighted_ili[-1],pch=19,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.5))
    }
    text(x=43,y=6,"Low Chance",pos=4,cex=2,lwd=4)
    text(x=43,y=8,"High Chance",pos=4,cex=2,lwd=4)
    dev.off()
}
files
file<-files[21]
plot(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.5))
ILI
ILI
plot(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.5))
for(file in files){
    forecasts<-read.csv(file)
    forecast.week<-as.numeric(substr(x=file,start=3,stop=4))
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week<=forecast.week & ILI$week>39),]
    }else{
        ILI<-ILI[which(ILI$week<=forecast.week | ILI$week>39),]
    }
    png(filename=paste0("C:/Users/iot0/Desktop/forecasting/short",forecast.week,".png"),width=1000,height=1000)
    par(lwd=4,mar=c(6,5,1,1))
    plot(x=rownames(ILI),y=ILI$weighted_ili,type="l",xlim=c(1,53),ylim=c(0,10),axes=FALSE,col="gray70",xlab="MMWR Week",ylab="ILI (%)",cex.axis=2,cex.lab=2)
    points(x=rownames(ILI),y=ILI$weighted_ili,pch=19,cex=2)
    axis(1,at=c(1,6,11,season.weeks-38,seq(season.weeks-33,season.weeks,by=5)),labels=c(40,45,50,1,seq(5,35,by=5)),cex.axis=2)
    axis(2,cex.axis=2)
    for(t in seq(1,4)){
        index<-which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & forecasts$type=="Bin")
        x0<-t+nrow(ILI)-0.4
        x1<-x0+0.8
        y<-as.numeric(as.character(forecasts$bin_start_incl[index]))
        probs<-forecasts$value[index]
        y.smooth<-seq(1,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=1,s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    i<-0
    for(y0 in seq(6,8,by=1e-4)){
        polygon(x=c(40,41,41,40,40),y=c(y0,y0,y0+1e-4,y0+1e-4,y0),col=hsv(h=1,s=i*5e-5,v=1),border=NA)
        i<-i+1
    }
    polygon(x=c(40,41,41,40,40),y=c(6,6,8,8,6),lwd=1)
    segments(x0=40,x1=42,y0=8,lwd=1)
    segments(x0=40,x1=42,y0=6,lwd=1)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which((ILI$week>=forecast.week & ILI$week<=season.weeks) | ILI$week<39),]
        points(x=as.numeric(rownames(ILI))+forecast.week-39,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.1))
        points(x=as.numeric(rownames(ILI))[-1]+forecast.week-39,y=ILI$weighted_ili[-1],pch=19,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.3))
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.1))
        points(x=as.numeric(rownames(ILI))[-1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[-1],pch=19,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.3))
    }
    text(x=43,y=6,"Low Chance",pos=4,cex=2,lwd=4)
    text(x=43,y=8,"High Chance",pos=4,cex=2,lwd=4)
    dev.off()
}
for(file in files){
    forecasts<-read.csv(file)
    forecast.week<-as.numeric(substr(x=file,start=3,stop=4))
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week<=forecast.week & ILI$week>39),]
    }else{
        ILI<-ILI[which(ILI$week<=forecast.week | ILI$week>39),]
    }
    png(filename=paste0("C:/Users/iot0/Desktop/forecasting/short",forecast.week,".png"),width=1000,height=1000)
    par(lwd=4,mar=c(6,5,1,1))
    plot(x=rownames(ILI),y=ILI$weighted_ili,type="l",xlim=c(1,53),ylim=c(0,10),axes=FALSE,col="gray70",xlab="MMWR Week",ylab="ILI (%)",cex.axis=2,cex.lab=2)
    points(x=rownames(ILI),y=ILI$weighted_ili,pch=19,cex=2)
    axis(1,at=c(1,6,11,season.weeks-38,seq(season.weeks-33,season.weeks,by=5)),labels=c(40,45,50,1,seq(5,35,by=5)),cex.axis=2)
    axis(2,cex.axis=2)
    for(t in seq(1,4)){
        index<-which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & forecasts$type=="Bin")
        x0<-t+nrow(ILI)-0.4
        x1<-x0+0.8
        y<-as.numeric(as.character(forecasts$bin_start_incl[index]))
        probs<-forecasts$value[index]
        y.smooth<-seq(1,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=1,s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    i<-0
    for(y0 in seq(6,8,by=1e-4)){
        polygon(x=c(40,41,41,40,40),y=c(y0,y0,y0+1e-4,y0+1e-4,y0),col=hsv(h=1,s=i*5e-5,v=1),border=NA)
        i<-i+1
    }
    polygon(x=c(40,41,41,40,40),y=c(6,6,8,8,6),lwd=1)
    segments(x0=40,x1=42,y0=8,lwd=1)
    segments(x0=40,x1=42,y0=6,lwd=1)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which((ILI$week>=forecast.week & ILI$week<=season.weeks) | ILI$week<39),]
        points(x=as.numeric(rownames(ILI))+forecast.week-39,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.3))
        points(x=as.numeric(rownames(ILI))[-1]+forecast.week-39,y=ILI$weighted_ili[-1],pch=19,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.3))
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.3))
        points(x=as.numeric(rownames(ILI))[-1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[-1],pch=19,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.3))
    }
    text(x=43,y=6,"Low Chance",pos=4,cex=2,lwd=4)
    text(x=43,y=8,"High Chance",pos=4,cex=2,lwd=4)
    dev.off()
}
dev.off()
for(file in files){
    forecasts<-read.csv(file)
    forecast.week<-as.numeric(substr(x=file,start=3,stop=4))
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week<=forecast.week & ILI$week>39),]
    }else{
        ILI<-ILI[which(ILI$week<=forecast.week | ILI$week>39),]
    }
    png(filename=paste0("C:/Users/iot0/Desktop/forecasting/short",forecast.week,".png"),width=1000,height=1000)
    par(lwd=4,mar=c(6,5,1,1))
    plot(x=rownames(ILI),y=ILI$weighted_ili,type="l",xlim=c(1,53),ylim=c(0,10),axes=FALSE,col="gray70",xlab="MMWR Week",ylab="ILI (%)",cex.axis=2,cex.lab=2)
    points(x=rownames(ILI),y=ILI$weighted_ili,pch=19,cex=2)
    axis(1,at=c(1,6,11,season.weeks-38,seq(season.weeks-33,season.weeks,by=5)),labels=c(40,45,50,1,seq(5,35,by=5)),cex.axis=2)
    axis(2,cex.axis=2)
    for(t in seq(1,4)){
        index<-which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & forecasts$type=="Bin")
        x0<-t+nrow(ILI)-0.4
        x1<-x0+0.8
        y<-as.numeric(as.character(forecasts$bin_start_incl[index]))
        probs<-forecasts$value[index]
        y.smooth<-seq(1,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=1,s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    i<-0
    for(y0 in seq(6,8,by=1e-4)){
        polygon(x=c(40,41,41,40,40),y=c(y0,y0,y0+1e-4,y0+1e-4,y0),col=hsv(h=1,s=i*5e-5,v=1),border=NA)
        i<-i+1
    }
    polygon(x=c(40,41,41,40,40),y=c(6,6,8,8,6),lwd=1)
    segments(x0=40,x1=42,y0=8,lwd=1)
    segments(x0=40,x1=42,y0=6,lwd=1)
    text(x=43,y=6,"Low Chance",pos=4,cex=2,lwd=4)
    text(x=43,y=8,"High Chance",pos=4,cex=2,lwd=4)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which((ILI$week>=forecast.week & ILI$week<=season.weeks) | ILI$week<39),]
        points(x=as.numeric(rownames(ILI))+forecast.week-39,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.3))
        points(x=as.numeric(rownames(ILI))[-1]+forecast.week-39,y=ILI$weighted_ili[-1],pch=19,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.3))
        points(x=as.numeric(rownames(ILI))[1]+forecast.week-39,y=ILI$weighted_ili[11],pch=19,cex=2)
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.3))
        points(x=as.numeric(rownames(ILI))[-1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[-1],pch=19,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.3))
        points(x=as.numeric(rownames(ILI))[1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[1],pch=19,cex=2)
    }
    dev.off()
}
files
file<-files[15]
dev.off()
ILI
forecast.week
team
files
file
forecasts
y
forecasts
index
)
levels(forecasts$location)
table(forecasts$location)
str(forecasts)
str(forecasts$Location)
files
file
?read.csv
str(forecasts)
str(forecasts)
head(forecasts)
for(file in files){
    forecasts<-read.csv(file,col.names=c("location","target","type","unit","bin_start_incl","bin_end_notincl","value"))
    forecast.week<-as.numeric(substr(x=file,start=3,stop=4))
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week<=forecast.week & ILI$week>39),]
    }else{
        ILI<-ILI[which(ILI$week<=forecast.week | ILI$week>39),]
    }
    png(filename=paste0("C:/Users/iot0/Desktop/forecasting/short",team,forecast.week,".png"),width=1000,height=1000)
    par(lwd=4,mar=c(6,5,1,1))
    plot(x=rownames(ILI),y=ILI$weighted_ili,type="l",xlim=c(1,53),ylim=c(0,10),axes=FALSE,col="gray70",xlab="MMWR Week",ylab="ILI (%)",cex.axis=2,cex.lab=2)
    points(x=rownames(ILI),y=ILI$weighted_ili,pch=19,cex=2)
    axis(1,at=c(1,6,11,season.weeks-38,seq(season.weeks-33,season.weeks,by=5)),labels=c(40,45,50,1,seq(5,35,by=5)),cex.axis=2)
    axis(2,cex.axis=2)
    for(t in seq(1,4)){
        index<-which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & forecasts$type=="Bin")
        x0<-t+nrow(ILI)-0.4
        x1<-x0+0.8
        y<-as.numeric(as.character(forecasts$bin_start_incl[index]))
        probs<-forecasts$value[index]
        y.smooth<-seq(1,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=1,s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    i<-0
    for(y0 in seq(6,8,by=1e-4)){
        polygon(x=c(40,41,41,40,40),y=c(y0,y0,y0+1e-4,y0+1e-4,y0),col=hsv(h=1,s=i*5e-5,v=1),border=NA)
        i<-i+1
    }
    polygon(x=c(40,41,41,40,40),y=c(6,6,8,8,6),lwd=1)
    segments(x0=40,x1=42,y0=8,lwd=1)
    segments(x0=40,x1=42,y0=6,lwd=1)
    text(x=43,y=6,"Low Chance",pos=4,cex=2,lwd=4)
    text(x=43,y=8,"High Chance",pos=4,cex=2,lwd=4)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which((ILI$week>=forecast.week & ILI$week<=season.weeks) | ILI$week<39),]
        points(x=as.numeric(rownames(ILI))+forecast.week-40,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+forecast.week-40,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+forecast.week-40,y=ILI$weighted_ili[1],pch=19,cex=2)
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[1],pch=19,cex=2)
    }
    dev.off()
}
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
x
y
str(forecasts)
index
which(forecasts$location=="US National"

which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead"))
which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & forecasts$type=="Bin")
which(forecasts$type=="Bin")
forecascs$type
forecasts$type
index
for(file in files){
    forecasts<-read.csv(file,col.names=c("location","target","type","unit","bin_start_incl","bin_end_notincl","value"))
    forecast.week<-as.numeric(substr(x=file,start=3,stop=4))
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week<=forecast.week & ILI$week>39),]
    }else{
        ILI<-ILI[which(ILI$week<=forecast.week | ILI$week>39),]
    }
    png(filename=paste0("C:/Users/iot0/Desktop/forecasting/short",team,forecast.week,".png"),width=1000,height=1000)
    par(lwd=4,mar=c(6,5,1,1))
    plot(x=rownames(ILI),y=ILI$weighted_ili,type="l",xlim=c(1,53),ylim=c(0,10),axes=FALSE,col="gray70",xlab="MMWR Week",ylab="ILI (%)",cex.axis=2,cex.lab=2)
    points(x=rownames(ILI),y=ILI$weighted_ili,pch=19,cex=2)
    axis(1,at=c(1,6,11,season.weeks-38,seq(season.weeks-33,season.weeks,by=5)),labels=c(40,45,50,1,seq(5,35,by=5)),cex.axis=2)
    axis(2,cex.axis=2)
    for(t in seq(1,4)){
        index<-which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & (forecasts$type=="Bin" | forecasts$type=="percent"))
        x0<-t+nrow(ILI)-0.4
        x1<-x0+0.8
        y<-as.numeric(as.character(forecasts$bin_start_incl[index]))
        probs<-forecasts$value[index]
        y.smooth<-seq(1,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=1,s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    i<-0
    for(y0 in seq(6,8,by=1e-4)){
        polygon(x=c(40,41,41,40,40),y=c(y0,y0,y0+1e-4,y0+1e-4,y0),col=hsv(h=1,s=i*5e-5,v=1),border=NA)
        i<-i+1
    }
    polygon(x=c(40,41,41,40,40),y=c(6,6,8,8,6),lwd=1)
    segments(x0=40,x1=42,y0=8,lwd=1)
    segments(x0=40,x1=42,y0=6,lwd=1)
    text(x=43,y=6,"Low Chance",pos=4,cex=2,lwd=4)
    text(x=43,y=8,"High Chance",pos=4,cex=2,lwd=4)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which((ILI$week>=forecast.week & ILI$week<=season.weeks) | ILI$week<39),]
        points(x=as.numeric(rownames(ILI))+forecast.week-40,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+forecast.week-40,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+forecast.week-40,y=ILI$weighted_ili[1],pch=19,cex=2)
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[1],pch=19,cex=2)
    }
    dev.off()
}
dev.off()
dev.off()
dev.off()
q()
plot(seq(1,10),col=hsv(h=seq(0.8,1,length.out=10)),cex=10,pch=2)
plot(seq(1,10),col=hsv(h=seq(0.6,1,length.out=10)),cex=10,pch=2)
plot(seq(1,10),col=hsv(h=seq(0.5,1,length.out=10)),cex=10,pch=2)
for(file in files){
    forecasts<-read.csv(file,col.names=c("location","target","type","unit","bin_start_incl","bin_end_notincl","value"))
    forecast.week<-as.numeric(substr(x=file,start=3,stop=4))
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week<=forecast.week & ILI$week>39),]
    }else{
        ILI<-ILI[which(ILI$week<=forecast.week | ILI$week>39),]
    }
    png(filename=paste0("C:/Users/iot0/Desktop/forecasting/ShortTermForecasts/short",team,forecast.week,".png"),width=1000,height=1000)
    par(lwd=4,mar=c(6,5,1,1))
    plot(x=rownames(ILI),y=ILI$weighted_ili,type="l",xlim=c(1,53),ylim=c(0,10),axes=FALSE,col="gray70",xlab="MMWR Week",ylab="ILI (%)",cex.axis=2,cex.lab=2)
    points(x=rownames(ILI),y=ILI$weighted_ili,pch=19,cex=2)
    axis(1,at=c(1,6,11,season.weeks-38,seq(season.weeks-33,season.weeks,by=5)),labels=c(40,45,50,1,seq(5,35,by=5)),cex.axis=2)
    axis(2,cex.axis=2)
    for(t in seq(1,4)){
        index<-which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & (forecasts$type=="Bin" | forecasts$type=="percent"))
        x0<-t+nrow(ILI)-0.4
        x1<-x0+0.8
        y<-as.numeric(as.character(forecasts$bin_start_incl[index]))
        probs<-forecasts$value[index]
        y.smooth<-seq(0,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=0.5+0.5*y.smooth/13,s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    i<-0
    for(y0 in seq(6,8,by=1e-4)){
        polygon(x=c(40,41,41,40,40),y=c(y0,y0,y0+1e-4,y0+1e-4,y0),col=hsv(h=1,s=i*5e-5,v=1),border=NA)
        i<-i+1
    }
    polygon(x=c(40,41,41,40,40),y=c(6,6,8,8,6),lwd=1)
    segments(x0=40,x1=42,y0=8,lwd=1)
    segments(x0=40,x1=42,y0=6,lwd=1)
    text(x=43,y=6,"Low Chance",pos=4,cex=2,lwd=4)
    text(x=43,y=8,"High Chance",pos=4,cex=2,lwd=4)
    text(x=15,y=9,paste("Week",forecast.week),lwd=4,col="gray80",cex=10,pos=4)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which((ILI$week>=forecast.week & ILI$week<=season.weeks) | ILI$week<39),]
        points(x=as.numeric(rownames(ILI))+forecast.week-40,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+forecast.week-40,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+forecast.week-40,y=ILI$weighted_ili[1],pch=19,cex=2)
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[1],pch=19,cex=2)
    }
    dev.off()
}
dev.off()
plot(seq(1,10),col=hsv(h=seq(0.75,1,length.out=10)),cex=10,pch=2)
log(2)
exp(0.5)
curve(expr=0.5+log(x))
curve(expr=0.5+x^2)
curve(expr=0.5+sqrt(x))
4*13
curve(expr=0.5+sqrt(52*x))
curve(expr=0.5+sqrt(x/52))
1/4/13
1/52
curve(expr=0.5+sqrt(x/52),from=0,to=13)
for(file in files){
    forecasts<-read.csv(file,col.names=c("location","target","type","unit","bin_start_incl","bin_end_notincl","value"))
    forecast.week<-as.numeric(substr(x=file,start=3,stop=4))
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week<=forecast.week & ILI$week>39),]
    }else{
        ILI<-ILI[which(ILI$week<=forecast.week | ILI$week>39),]
    }
    png(filename=paste0("C:/Users/iot0/Desktop/forecasting/ShortTermForecasts/short",team,forecast.week,".png"),width=1000,height=1000)
    par(lwd=4,mar=c(6,5,1,1))
    plot(x=rownames(ILI),y=ILI$weighted_ili,type="l",xlim=c(1,53),ylim=c(0,10),axes=FALSE,col="gray70",xlab="MMWR Week",ylab="ILI (%)",cex.axis=2,cex.lab=2)
    points(x=rownames(ILI),y=ILI$weighted_ili,pch=19,cex=2)
    axis(1,at=c(1,6,11,season.weeks-38,seq(season.weeks-33,season.weeks,by=5)),labels=c(40,45,50,1,seq(5,35,by=5)),cex.axis=2)
    axis(2,cex.axis=2)
    for(t in seq(1,4)){
        index<-which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & (forecasts$type=="Bin" | forecasts$type=="percent"))
        x0<-t+nrow(ILI)-0.4
        x1<-x0+0.8
        y<-as.numeric(as.character(forecasts$bin_start_incl[index]))
        probs<-forecasts$value[index]
        y.smooth<-seq(0,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=0.5+sqrt(y.smooth/52),s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    i<-0
    for(y0 in seq(6,8,by=1e-4)){
        polygon(x=c(40,41,41,40,40),y=c(y0,y0,y0+1e-4,y0+1e-4,y0),col=hsv(h=1,s=i*5e-5,v=1),border=NA)
        i<-i+1
    }
    polygon(x=c(40,41,41,40,40),y=c(6,6,8,8,6),lwd=1)
    segments(x0=40,x1=42,y0=8,lwd=1)
    segments(x0=40,x1=42,y0=6,lwd=1)
    text(x=43,y=6,"Low Chance",pos=4,cex=2,lwd=4)
    text(x=43,y=8,"High Chance",pos=4,cex=2,lwd=4)
    text(x=15,y=9,paste("Week",forecast.week),lwd=4,col="gray80",cex=10,pos=4)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which((ILI$week>=forecast.week & ILI$week<=season.weeks) | ILI$week<39),]
        points(x=as.numeric(rownames(ILI))+forecast.week-40,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+forecast.week-40,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+forecast.week-40,y=ILI$weighted_ili[1],pch=19,cex=2)
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[1],pch=19,cex=2)
    }
    dev.off()
}
for(file in files){
    forecasts<-read.csv(file,col.names=c("location","target","type","unit","bin_start_incl","bin_end_notincl","value"))
    forecast.week<-as.numeric(substr(x=file,start=3,stop=4))
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week<=forecast.week & ILI$week>39),]
    }else{
        ILI<-ILI[which(ILI$week<=forecast.week | ILI$week>39),]
    }
    png(filename=paste0("C:/Users/iot0/Desktop/forecasting/ShortTermForecasts/short",team,forecast.week,".png"),width=1000,height=1000)
    par(lwd=4,mar=c(6,5,1,1))
    plot(x=rownames(ILI),y=ILI$weighted_ili,type="l",xlim=c(1,53),ylim=c(0,10),axes=FALSE,col="gray70",xlab="MMWR Week",ylab="ILI (%)",cex.axis=2,cex.lab=2)
    points(x=rownames(ILI),y=ILI$weighted_ili,pch=19,cex=2)
    axis(1,at=c(1,6,11,season.weeks-38,seq(season.weeks-33,season.weeks,by=5)),labels=c(40,45,50,1,seq(5,35,by=5)),cex.axis=2)
    axis(2,cex.axis=2)
    for(t in seq(1,4)){
        index<-which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & (forecasts$type=="Bin" | forecasts$type=="percent"))
        x0<-t+nrow(ILI)-0.4
        x1<-x0+0.8
        y<-as.numeric(as.character(forecasts$bin_start_incl[index]))
        probs<-forecasts$value[index]
        y.smooth<-seq(0,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=0.5+sqrt(min(y.smooth,8)/32),s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    i<-0
    for(y0 in seq(6,8,by=1e-4)){
        polygon(x=c(40,41,41,40,40),y=c(y0,y0,y0+1e-4,y0+1e-4,y0),col=hsv(h=1,s=i*5e-5,v=1),border=NA)
        i<-i+1
    }
    polygon(x=c(40,41,41,40,40),y=c(6,6,8,8,6),lwd=1)
    segments(x0=40,x1=42,y0=8,lwd=1)
    segments(x0=40,x1=42,y0=6,lwd=1)
    text(x=43,y=6,"Low Chance",pos=4,cex=2,lwd=4)
    text(x=43,y=8,"High Chance",pos=4,cex=2,lwd=4)
    text(x=15,y=9,paste("Week",forecast.week),lwd=4,col="gray80",cex=10,pos=4)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which((ILI$week>=forecast.week & ILI$week<=season.weeks) | ILI$week<39),]
        points(x=as.numeric(rownames(ILI))+forecast.week-40,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+forecast.week-40,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+forecast.week-40,y=ILI$weighted_ili[1],pch=19,cex=2)
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[1],pch=19,cex=2)
    }
    dev.off()
}
curve(expr=0.5+sqrt(max(x,8)/52),from=0,to=13)
curve(expr=0.5+sqrt(max(x,8)/52),from=0,to=13)
curve(expr=0.5+sqrt(x/52),from=0,to=13)
curve(expr=0.5+sqrt(x/32),from=0,to=13)
curve(expr=0.5+sqrt(x),from=0,to=13)
dev.off()
dev.off()
curve(expr=0.5+sqrt(x),from=0,to=13)
curve(expr=0.5+sqrt(x/32),from=0,to=13)
for(file in files){
    forecasts<-read.csv(file,col.names=c("location","target","type","unit","bin_start_incl","bin_end_notincl","value"))
    forecast.week<-as.numeric(substr(x=file,start=3,stop=4))
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week<=forecast.week & ILI$week>39),]
    }else{
        ILI<-ILI[which(ILI$week<=forecast.week | ILI$week>39),]
    }
    png(filename=paste0("C:/Users/iot0/Desktop/forecasting/ShortTermForecasts/short",team,forecast.week,".png"),width=1000,height=1000)
    par(lwd=4,mar=c(6,5,1,1))
    plot(x=rownames(ILI),y=ILI$weighted_ili,type="l",xlim=c(1,53),ylim=c(0,10),axes=FALSE,col="gray70",xlab="MMWR Week",ylab="ILI (%)",cex.axis=2,cex.lab=2)
    points(x=rownames(ILI),y=ILI$weighted_ili,pch=19,cex=2)
    axis(1,at=c(1,6,11,season.weeks-38,seq(season.weeks-33,season.weeks,by=5)),labels=c(40,45,50,1,seq(5,35,by=5)),cex.axis=2)
    axis(2,cex.axis=2)
    for(t in seq(1,4)){
        index<-which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & (forecasts$type=="Bin" | forecasts$type=="percent"))
        x0<-t+nrow(ILI)-0.4
        x1<-x0+0.8
        y<-as.numeric(as.character(forecasts$bin_start_incl[index]))
        probs<-forecasts$value[index]
        y.smooth<-seq(0,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=0.5+sqrt(pmin(y.smooth,8)/32),s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    i<-0
    for(y0 in seq(6,8,by=1e-4)){
        polygon(x=c(40,41,41,40,40),y=c(y0,y0,y0+1e-4,y0+1e-4,y0),col=hsv(h=1,s=i*5e-5,v=1),border=NA)
        i<-i+1
    }
    polygon(x=c(40,41,41,40,40),y=c(6,6,8,8,6),lwd=1)
    segments(x0=40,x1=42,y0=8,lwd=1)
    segments(x0=40,x1=42,y0=6,lwd=1)
    text(x=43,y=6,"Low Chance",pos=4,cex=2,lwd=4)
    text(x=43,y=8,"High Chance",pos=4,cex=2,lwd=4)
    text(x=15,y=9,paste("Week",forecast.week),lwd=4,col="gray80",cex=10,pos=4)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which((ILI$week>=forecast.week & ILI$week<=season.weeks) | ILI$week<39),]
        points(x=as.numeric(rownames(ILI))+forecast.week-40,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+forecast.week-40,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+forecast.week-40,y=ILI$weighted_ili[1],pch=19,cex=2)
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[1],pch=19,cex=2)
    }
    dev.off()
}
plot(seq(1,10),col=hsv(h=1,s=seq(1,10),v=0),cex=10,pch=4)
plot(seq(1,10),col=hsv(h=1,s=seq(0,1,length.out=10),v=0),cex=10,pch=4)
plot(seq(1,10),col=hsv(h=1,s=seq(0,1,length.out=10),v=1),cex=10,pch=4)
plot(seq(1,10),col=hsv(h=1,s=0,v=seq(0,1,length.out=10)),cex=10,pch=4)
i
for(file in files){
    forecasts<-read.csv(file,col.names=c("location","target","type","unit","bin_start_incl","bin_end_notincl","value"))
    forecast.week<-as.numeric(substr(x=file,start=3,stop=4))
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week<=forecast.week & ILI$week>39),]
    }else{
        ILI<-ILI[which(ILI$week<=forecast.week | ILI$week>39),]
    }
    png(filename=paste0("C:/Users/iot0/Desktop/forecasting/ShortTermForecasts/short",team,forecast.week,".png"),width=1000,height=1000)
    par(lwd=4,mar=c(6,5,1,1))
    plot(x=rownames(ILI),y=ILI$weighted_ili,type="l",xlim=c(1,53),ylim=c(0,10),axes=FALSE,col="gray70",xlab="MMWR Week",ylab="ILI (%)",cex.axis=2,cex.lab=2)
    points(x=rownames(ILI),y=ILI$weighted_ili,pch=19,cex=2)
    axis(1,at=c(1,6,11,season.weeks-38,seq(season.weeks-33,season.weeks,by=5)),labels=c(40,45,50,1,seq(5,35,by=5)),cex.axis=2)
    axis(2,cex.axis=2)
    for(t in seq(1,4)){
        index<-which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & (forecasts$type=="Bin" | forecasts$type=="percent"))
        x0<-t+nrow(ILI)-0.4
        x1<-x0+0.8
        y<-as.numeric(as.character(forecasts$bin_start_incl[index]))
        probs<-forecasts$value[index]
        y.smooth<-seq(0,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=0.5+sqrt(pmin(y.smooth,6)/24),s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    i<-0
    for(y0 in seq(6,8,by=1e-4)){
        polygon(x=c(40,41,41,40,40),y=c(y0,y0,y0+1e-4,y0+1e-4,y0),col=hsv(h=1,s=i*5e-5,v=y0/2-3),border=NA)
        i<-i+1
    }
    polygon(x=c(40,41,41,40,40),y=c(6,6,8,8,6),lwd=1)
    segments(x0=40,x1=42,y0=8,lwd=1)
    segments(x0=40,x1=42,y0=6,lwd=1)
    text(x=43,y=6,"Low Chance",pos=4,cex=2,lwd=4)
    text(x=43,y=8,"High Chance",pos=4,cex=2,lwd=4)
    text(x=15,y=9,paste("Week",forecast.week),lwd=4,col="gray80",cex=10,pos=4)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which((ILI$week>=forecast.week & ILI$week<=season.weeks) | ILI$week<39),]
        points(x=as.numeric(rownames(ILI))+forecast.week-40,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+forecast.week-40,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+forecast.week-40,y=ILI$weighted_ili[1],pch=19,cex=2)
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[1],pch=19,cex=2)
    }
    dev.off()
}
dev.off()
dev.off()
dev.off()
dev.off()
length(seq(38,42,1e-4)
)
plot(x=1,xlim=c(37,43),ylim=c(5,9))
i
j
    for(y0 in seq(6,8,by=1e-4)){
        j<-0
        for(x0 in seq(38,42,by=1e-4)){
            polygon(x=c(x0,x0+1e-4,x0+1e-4,x0,x0),y=c(y0,y0,y0+1e-4,y0+1e-4,y0),col=hsv(h=0.5+j*1e-5,s=i*5e-5,v=1),border=NA)
            j<-j+1
        }
        i<-i+1
    }
i
j
i
j
21*0.05
y0
length(seq(6,8,1e-2)
)
200*5e-2
200*5e-3
h
i
j
i*5e-2
i
j
x0
0.5+j*1e-2
length(seq(38,42,1e-2))
0.5*400*1e-3
0.5*400*5e-3
i
j
0.5+101*5e-3
0.5+101*5e-4
0.5+101*5e-3
0.5+101*5e-4
0.5+400*5e-4
0.5+400*1e-4
0.5+400*2e-4
0.5+400*2e-3
0.5+400*1e-3
0.5+400*2e-3
0.5+4000/9e-3
0.5+4000/9*e-3
0.5+4000/9*1e-3
400*1e-3
400*5/41e-3
400*5/4*1e-3
5/4
i
length(seq(6,8,1e-2)
)
length(seq(38,42,1e-2))
plot(x=1,xlim=c(25,52),ylim=c(0,13))
    text(x=44,y=8,"High Severity",pos=4,cex=2,lwd=4)
segments(x0=38,y0=8,y1=5,lwd=1)
plot(x=1,xlim=c(25,52),ylim=c(0,13))
for(file in files){
    forecasts<-read.csv(file,col.names=c("location","target","type","unit","bin_start_incl","bin_end_notincl","value"))
    forecast.week<-as.numeric(substr(x=file,start=3,stop=4))
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week<=forecast.week & ILI$week>39),]
    }else{
        ILI<-ILI[which(ILI$week<=forecast.week | ILI$week>39),]
    }
    png(filename=paste0("C:/Users/iot0/Desktop/forecasting/ShortTermForecasts/short",team,forecast.week,".png"),width=1000,height=1000)
    par(lwd=4,mar=c(6,5,1,1))
    plot(x=rownames(ILI),y=ILI$weighted_ili,type="l",xlim=c(1,53),ylim=c(0,10),axes=FALSE,col="gray70",xlab="MMWR Week",ylab="ILI (%)",cex.axis=2,cex.lab=2)
    points(x=rownames(ILI),y=ILI$weighted_ili,pch=19,cex=2)
    axis(1,at=c(1,6,11,season.weeks-38,seq(season.weeks-33,season.weeks,by=5)),labels=c(40,45,50,1,seq(5,35,by=5)),cex.axis=2)
    axis(2,cex.axis=2)
    for(t in seq(1,4)){
        index<-which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & (forecasts$type=="Bin" | forecasts$type=="percent"))
        x0<-t+nrow(ILI)-0.4
        x1<-x0+0.8
        y<-as.numeric(as.character(forecasts$bin_start_incl[index]))
        probs<-forecasts$value[index]
        y.smooth<-seq(0,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=0.5+sqrt(pmin(y.smooth,6)/24),s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    j<-0
    for(y0 in seq(6,8,by=1e-2)){
        i<-0
        for(x0 in seq(38,42,by=1e-2)){
            polygon(
                x=c(x0,x0+1e-2,x0+1e-2,x0,x0),
                y=c(y0,y0,y0+1e-2,y0+1e-2,y0),
                col=hsv(
                    h=0.5+j/400,
                    s=1-i/400,
                    v=1
                ),
                border=NA
            )
            i<-i+1
        }
        j<-j+1
    }
    polygon(x=c(38,42,42,38,38),y=c(6,6,8,8,6),lwd=1)
    segments(x0=38,x1=44,y0=8,lwd=1)
    segments(x0=38,x1=44,y0=6,lwd=1)
    text(x=44,y=6,"Low Severity",pos=4,cex=2,lwd=4)
    text(x=44,y=8,"High Severity",pos=4,cex=2,lwd=4)
    segments(x0=38,y0=8,y1=5,lwd=1)
    segments(x0=42,y0=8,y1=5,lwd=1)
    text(x=38,y=5,"High Chance",pos=1,cex=2,lwd=4)
    text(x=42,y=5,"Low Chance",pos=1,cex=2,lwd=4)
    text(x=15,y=9,paste("Week",forecast.week),lwd=4,col="gray80",cex=10,pos=4)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which((ILI$week>=forecast.week & ILI$week<=season.weeks) | ILI$week<39),]
        points(x=as.numeric(rownames(ILI))+forecast.week-40,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+forecast.week-40,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+forecast.week-40,y=ILI$weighted_ili[1],pch=19,cex=2)
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[1],pch=19,cex=2)
    }
    dev.off()
}
dev.off()
plot(x=1,xlim=c(25,52),ylim=c(0,13))
for(file in files){
    forecasts<-read.csv(file,col.names=c("location","target","type","unit","bin_start_incl","bin_end_notincl","value"))
    forecast.week<-as.numeric(substr(x=file,start=3,stop=4))
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which(ILI$week<=forecast.week & ILI$week>39),]
    }else{
        ILI<-ILI[which(ILI$week<=forecast.week | ILI$week>39),]
    }
    png(filename=paste0("C:/Users/iot0/Desktop/forecasting/ShortTermForecasts/short",team,forecast.week,".png"),width=1000,height=1000)
    par(lwd=4,mar=c(6,5,1,1))
    plot(x=rownames(ILI),y=ILI$weighted_ili,type="l",xlim=c(1,53),ylim=c(0,10),axes=FALSE,col="gray70",xlab="MMWR Week",ylab="ILI (%)",cex.axis=2,cex.lab=2)
    points(x=rownames(ILI),y=ILI$weighted_ili,pch=19,cex=2)
    axis(1,at=c(1,6,11,season.weeks-38,seq(season.weeks-33,season.weeks,by=5)),labels=c(40,45,50,1,seq(5,35,by=5)),cex.axis=2)
    axis(2,cex.axis=2)
    for(t in seq(1,4)){
        index<-which(forecasts$location=="US National" & forecasts$target==paste(t,"wk ahead") & (forecasts$type=="Bin" | forecasts$type=="percent"))
        x0<-t+nrow(ILI)-0.4
        x1<-x0+0.8
        y<-as.numeric(as.character(forecasts$bin_start_incl[index]))
        probs<-forecasts$value[index]
        y.smooth<-seq(0,13,length.out=1e5)
        probs.smooth<-approx(x=y,y=probs,xout=y.smooth)$y
        y<-y.smooth
        bin.col<-hsv(h=0.5+sqrt(pmin(y.smooth,6)/24),s=pmin(1,probs.smooth/max.prob),v=1)
        for(i in 2:(length(y.smooth))){
            polygon(x=c(x0,x1,x1,x0,x0),y=c(y[i-1],y[i-1],y[i],y[i],y[i-1]),col=bin.col[i-1],border=NA)
        }
    }
    abline(h=2.2,lwd=2,col="gray70",lty=2)
    j<-0
    for(y0 in seq(6,8,by=1e-2)){
        i<-0
        for(x0 in seq(38,42,by=1e-2)){
            polygon(
                x=c(x0,x0+1e-2,x0+1e-2,x0,x0),
                y=c(y0,y0,y0+1e-2,y0+1e-2,y0),
                col=hsv(
                    h=0.5+j/400,
                    s=1-i/400,
                    v=1
                ),
                border=NA
            )
            i<-i+1
        }
        j<-j+1
    }
    polygon(x=c(38,42,42,38,38),y=c(6,6,8,8,6),lwd=1)
    arrows(x0=45,y0=6,y1=8)
    text(x=45,y=8,"Severity",pos=3,cex=2)
    arrows(x0=42,x1=38,y0=5.5)
    text(x=38,y=5.5,"Chance",pos=2,cex=2)
    text(x=15,y=9,paste("Week",forecast.week),lwd=4,col="gray80",cex=10,pos=4)
    ILI<-ILI.master
    if(forecast.week>39){
        ILI<-ILI[which((ILI$week>=forecast.week & ILI$week<=season.weeks) | ILI$week<39),]
        points(x=as.numeric(rownames(ILI))+forecast.week-40,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+forecast.week-40,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+forecast.week-40,y=ILI$weighted_ili[1],pch=19,cex=2)
    }else{
        ILI<-ILI[which(ILI$week>=forecast.week & ILI$week<40),]
        points(x=as.numeric(rownames(ILI))+season.weeks-40+forecast.week,y=ILI$weighted_ili,type="l",col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        ##points(x=as.numeric(rownames(ILI))[-1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[-1],pch=1,cex=2,col=hsv(h=1,s=0,v=0.8,alpha=0.6))
        points(x=as.numeric(rownames(ILI))[1]+season.weeks-40+forecast.week,y=ILI$weighted_ili[1],pch=19,cex=2)
    }
    dev.off()
}
dev.off()
dev.off()
q()
